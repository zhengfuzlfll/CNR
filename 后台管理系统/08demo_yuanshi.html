<!DOCTYPE html>
<html lang="en">

<head>
	<title>订单信息管理</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
	<link rel="stylesheet" href="css/uniform.css" />
	<link rel="stylesheet" href="css/select2.css" />
	<link rel="stylesheet" href="css/matrix-style2.css" />
	<link rel="stylesheet" href="css/matrix-media.css" />
	<link href="font-awesome/css/font-awesome.css" rel="stylesheet" />
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
	<style>
		.act {
			border: 1px solid red;
		}
	</style>
</head>

<body>

	<div id="content">
		<div id="content-header">
			<h1>订单信息管理</h1>
		</div>
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<!--新模块放这里-->
					<div class="widget-box">
						<div class="widget-title"> <span class="icon"> <i class="icon-th"></i> </span>
							<h5>订单信息管理</h5>
							<span class="label label-info">Featured</span>
						</div>
						<div class="widget-content ">
							<table class="table table-bordered table-striped with-check">
								<thead>
									<tr>
										<th>
											<div class="checker" id="uniform-title-table-checkbox">
												<!-- <span class=""> -->
												<input type="checkbox" id="title-table-checkbox"
													name="title-table-checkbox">
												<!-- </span> -->
											</div>
										</th>
										<th>gid</th>
										<th>商品名称</th>
										<th>单价</th>
										<th>购买数量</th>
										<th>总价格</th>
										<th>库存量</th>
										<th>图片路径</th>
										<th>操作</th>
										<!-- <th>单价</th> -->
									</tr>
								</thead>
								<tbody>
									<!-- <tr>
										<td>
											<div class=" checker" id="uniform-undefined">
												<input type="checkbox" id="title-table-checkbox"
													name="title-table-checkbox">
												//<input type="checkbox" />
											</div>
										</td>
										<td>666666666</td>
										<td contenteditable="true">苹果6666666666</td>
										<td contenteditable="true">￥4000</td>
										<td contenteditable="true">30</td>
										<td contenteditable="true">￥120000</td>
										<td contenteditable="true">30</td>
										<td contenteditable="true">http://www.ss.com/ss.jpg</td>
										<td>
											<button type="button" class="btn btn-success">修改并保存</button>
											<button type="button" class="btn btn-danger">删除</button>
										</td>
									</tr> -->
								</tbody>
							</table>
						</div>
					</div>
					<div class="form-actions">

						<button type="submit" class="btn btn-danger">全删</button>
					</div>
					<div class="dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_full_numbers"
						id="DataTables_Table_0_paginate">
						<a tabindex="0"
							class="first ui-corner-tl ui-corner-bl fg-button ui-button ui-state-default ui-state-disabled"
							id="DataTables_Table_0_first">First</a>
						<a tabindex="0" class="previous fg-button ui-button ui-state-default ui-state-disabled"
							id="DataTables_Table_0_previous">Previous</a><span><a tabindex="0"
								class="fg-button ui-button ui-state-default ui-state-disabled">1</a><a tabindex="0"
								class="fg-button ui-button ui-state-default">2</a><a tabindex="0"
								class="fg-button ui-button ui-state-default">3</a><a tabindex="0"
								class="fg-button ui-button ui-state-default">4</a><a tabindex="0"
								class="fg-button ui-button ui-state-default">5</a></span>
						<a tabindex="0" class="next fg-button ui-button ui-state-default"
							id="DataTables_Table_0_next">Next</a>
						<a tabindex="0" class="last ui-corner-tr ui-corner-br fg-button ui-button ui-state-default"
							id="DataTables_Table_0_last">Last</a>
					</div>

					<div class="widget-box">
						<div class="widget-title"> <span class="icon"> <i class="icon-align-justify"></i> </span>
							<h5>添加新订单</h5>
						</div>
						<div class="widget-content nopadding">
							<form action="#" method="get" class="form-horizontal">
								<div class="control-group">
									<label class="control-label">商品名称</label>
									<div class="controls">
										<input type="text" class="span11" placeholder="商品名称" id="goodname">
									</div>
								</div>
								<!-- <div class="control-group">
										<label class="control-label">商品价格</label>
										<div class="controls">
											<input type="text" class="span11" placeholder="商品价格">
										</div>
									</div> -->
								<!--<div class="control-group">
										<label class="control-label">商品价格</label>
										<div class="controls">
											<input type="password" class="span11" placeholder="Enter Password">
										</div>
									</div>-->
								<div class="control-group">
									<label class="control-label">库存量</label>
									<div class="controls">
										<input type="text" class="span11" placeholder="库存量" id="kucun">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">购买数量</label>
									<div class="controls">
										<input type="text" class="span11" placeholder="购买数量" id="numBuy">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">图片路径</label>
									<div class="controls">
										<input type="text" class="span11" placeholder="图片路径" id="imgUrl">
										<!-- <span class="help-block">Description field</span> </div> -->
									</div>
									<div class="control-group">
										<label class="control-label">商品单价</label>
										<div class="controls">
											<div class="input-append">
												<input type="text" placeholder="00.000" class="span11" id="price">
												<span class="add-on">￥</span> </div>
										</div>
									</div>
									<!--<div class="control-group">
										<label class="control-label">Message</label>
										<div class="controls">
											<textarea class="span11"></textarea>
										</div>
									</div>-->
									<div class="form-actions">
										<button type="button" class="btn btn-success">添加</button>
									</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="js/myquery.js"></script>
	<script src="http://www.jq22.com/jquery/jquery-1.7.1.js"></script>
	<script src="js/jquery.ui.custom.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.uniform.js"></script>
	<script src="js/select2.min.js"></script>
	<script src="js/jquery.dataTables.min.js"></script>
	<script src="js/matrix.js"></script>
	<script src="js/matrix.tables.js"></script>


	<script type="text/javascript">
		// window.location = function () {
		let goodname = document.querySelector("#goodname"); /* 商品名称 */
		let kucun = document.querySelector("#kucun"); /* 库存 */
		let numBuy = document.querySelector("#numBuy"); /* 购买数量 */
		let imgUrl = document.querySelector("#imgUrl"); /* 图片路径 */
		let price = document.querySelector("#price"); /* 单价 */
		// console.log(goodname, kucun, numBuy, imgUrl, price);
		let btnsuccess = document.querySelector(".btn-success");

		/* 1--商品名称 */
		goodname.onblur = function () {
			let val_1 = goodname.value.trim();
			if (val_1) {
				// kucun.focus();
				goodname.className = "act";
			} else {
				alert("请输入商品名称")
			}
		}

		/* 2--库存量 */
		kucun.onblur = function () {
			let val_2 = kucun.value.trim();
			if (val_2) {
				kucun.className = "act";
				// numBuy.focus();

			} else {
				alert("请输入库存数量")
			}
		}

		/*3-- 购买数量 */
		numBuy.onblur = function () {
			let val_2 = kucun.value.trim(); /* 库存 */
			let val_3 = numBuy.value.trim(); /* 购买数量 */
			if (val_3) {
				if (val_3 <= val_2 && val_3 > 0) {
					/* 防止出现购买数量大于库存量    购买数量至少为1*/
					numBuy.className = "act";
					// imgUrl.focus();
				} else {
					alert("请正确填写购买数量")
				}

			} else {
				alert("请输入商品单价")
			}
		}

		/*4-- 图片路径 */
		imgUrl.onblur = function () {
			let val_4 = imgUrl.value.trim();
			if (val_4) {
				imgUrl.className = "act";
				// price.focus();
			} else {
				alert("请输入图片路径")
			}
		}

		/*5-- 商品单价 */
		price.onblur = function () {
			let val_5 = price.value.trim();
			if (val_5) {
				// imgUrl.focus() 	;
				price.className = "act";
			} else {
				alert("请输入商品单价")
			}
		}


		// 添加商品 
		btnsuccess.onclick = function () {
			// console.log(66666);
			let val_1 = goodname.value.trim();
			let val_2 = kucun.value.trim();
			let val_3 = numBuy.value.trim();
			let val_4 = imgUrl.value.trim();
			let val_5 = price.value.trim();
			let totalprice = val_5 * val_3;
			if (val_1 && val_2 && val_3 && val_4 && val_5) {
				if (goodname.className == "act" && kucun.className == "act" && numBuy.className == "act" && imgUrl
					.className == "act" && price.className == "act") {
					ajax({
						type: 'post',
						url: 'api/06addgood.php',
						data: {
							goodname: val_1, //商品名
							price: val_5, //单价
							num: val_3, //购买数量
							totalprice: totalprice, //总价格
							kucun: val_2, //库存
							img: val_4 //图片路径

						},
						success: str => {
							// let arr = JSON.parse(str)
							console.log(str);
							if (str) {
								console.log(val_1);
								console.log(val_2);
								console.log(val_3);
								console.log(val_4);
								console.log(val_5);
								console.log(totalprice);

								alert('添加成功');

								goodname.value = '';
								kucun.value = '';
								numBuy.value = '';
								imgUrl.value = '';
								price.value = '';
							} else {
								alert("添加失败")
							}

						}
					})
				} else {
					alert("请正确填写商品信息！")
				}
			} else {
				alert("请完善信息！")
			}

		}



		// 显示商品
		ajax({
			type: 'post',
			url: 'api/06addgood_2.php',
			success: str => {
				let arr = JSON.parse(str)
				console.log(arr);
				create(arr);
			}
		})

		let tbody = document.querySelector("tbody");
		// console.log(tbody);


		function create(data) {

			tbody.innerHTML = data.map((item) => {

				return `
						<tr data-id='${item.gid}'>
							<td>
								<input type="checkbox">
							</td>
							<td contenteditable="true">${item.gid}</td>
							<td contenteditable="true">${item.goodname}</td>
							<td contenteditable="true">￥${item.price}</td>
							<td contenteditable="true">${item.num}</td>
							<td contenteditable="true">￥${item.totalprice}</td>
							<td contenteditable="true">${item.kucun}</td>
							<td contenteditable="true">${item.img}</td>
							<td>
								<button class="btnsuccess">修改并保存</button>
								<button class="btndanger">删除</button>
							</td>
						</tr>
					`
			}).join('');


			// 页码









			let btnsuccess = document.querySelector(".btnsuccess") //修改并保存按钮
			let btndanger = document.querySelector(".btndanger"); //删除按钮
			// console.log(btnsuccess, btndanger);

			tbody.onclick = function (eve) {
				// console.log(666);
				eve = eve || window.event;
				let target = eve.target || target ? eve.target : eve.srcElement;
				// console.log(target);
				let gid = target.parentNode.parentNode.dataset.id;
				console.log(gid);

				//编辑并保存
				if (target.className == "btnsuccess") {
					console.log("+++++++");

				}

				// 删除商品
				if (target.className == "btndanger") { //删除
					// console.log("-------");
					// confirm("确定删除？");
					if (confirm("确定删除？") == true) {
						// console.log(666);
						ajax({
							type: 'post',
							url: 'api/06addgood_3.php',
							data: {
								gid: gid
							},
							success: str => {
								console.log(str);
								if (str) {
									tbody.removeChild(target.parentNode.parentNode);
									// alert("删除成功");

								} else {
									alert("删除失败！");
								}

							}
						})
					}
				}
			}

		}
		// }












		// tbody.innerHTML = data.map((item) => {
		// 	return `
		// 		<tr>
		// 			<td>
		// 				<div class=" checker" id="uniform-undefined">
		// 					<input type="checkbox" />
		// 				</div>
		// 			</td>
		// 			<td>${item.gid}</td>
		// 			<td contenteditable="true">${item.goodname}</td>
		// 			<td contenteditable="true">￥${item.price}</td>
		// 			<td contenteditable="true">${item.num}</td>
		// 			<td contenteditable="true">￥${item.totalprice}</td>
		// 			<td contenteditable="true">${item.kucun}</td>
		// 			<td contenteditable="true">${item.img}</td>
		// 			<td>
		// 				<button type="button" class="btn btn-success">修改并保存</button>
		// 				<button type="button" class="btn btn-danger">删除</button>
		// 			</td>
		// 		</tr> 
		// 		`
		// }).join('');
	</script>
</body>

</html>